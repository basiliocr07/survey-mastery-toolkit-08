@model SurveyApp.Web.Models.CreateSurveyViewModel
@{
    ViewData["Title"] = "Create Survey";
}

<link rel="stylesheet" href="~/css/surveys.css" />

<div class="min-h-screen flex flex-col bg-background">
    <main class="flex-1 w-full max-w-7xl mx-auto pt-24 px-6 pb-16">
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Create a New Survey</h1>
            <p class="text-muted-foreground">
                Design your survey, add questions, and customize settings
            </p>
        </div>
        
        <div class="tabs-container" x-data="{ activeTab: 'design' }">
            <div class="grid w-full grid-cols-4 mb-8 tabs-list">
                <button x-on:click="activeTab = 'design'" x-bind:class="{ 'active': activeTab === 'design' }" class="tab-trigger">Design Survey</button>
                <button x-on:click="activeTab = 'delivery'" x-bind:class="{ 'active': activeTab === 'delivery' }" class="tab-trigger">Email Delivery</button>
                <button x-on:click="activeTab = 'settings'" x-bind:class="{ 'active': activeTab === 'settings' }" class="tab-trigger">Settings</button>
                <button x-on:click="activeTab = 'preview'" x-bind:class="{ 'active': activeTab === 'preview' }" class="tab-trigger">Preview</button>
            </div>
            
            <div x-show="activeTab === 'design'" class="tab-content animate-fade-in">
                <div class="grid gap-8">
                    <form asp-action="Create" method="post">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">Survey Details</h2>
                            </div>
                            <div class="card-content space-y-4">
                                <div>
                                    <label for="survey-title" class="block text-sm font-medium mb-1">
                                        Survey Title
                                    </label>
                                    <input asp-for="Title" id="survey-title" class="w-full px-4 py-2 border rounded-md" placeholder="Enter survey title" />
                                    <span asp-validation-for="Title" class="text-destructive text-sm"></span>
                                </div>
                                <div>
                                    <label for="survey-description" class="block text-sm font-medium mb-1">
                                        Description (optional)
                                    </label>
                                    <textarea asp-for="Description" id="survey-description" class="min-h-[100px] w-full px-4 py-2 border rounded-md" placeholder="Enter a description for your survey"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-semibold">Questions</h2>
                                <button type="button" id="add-question" class="bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 rounded-md flex items-center">
                                    <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Add Question
                                </button>
                            </div>
                            
                            <div id="questions-container" class="space-y-4">
                                @for (var i = 0; i < Model.Questions.Count; i++)
                                {
                                    <div class="question-builder card">
                                        <div class="card-header flex justify-between">
                                            <div class="flex items-center">
                                                <input type="hidden" asp-for="Questions[i].Id" />
                                                <select asp-for="Questions[i].Type" class="bg-muted p-2 rounded-md mr-2">
                                                    <option value="single-choice">Single Choice</option>
                                                    <option value="multiple-choice">Multiple Choice</option>
                                                    <option value="text">Text Input</option>
                                                    <option value="rating">Star Rating</option>
                                                    <option value="nps">NPS Rating</option>
                                                </select>
                                                <div class="flex items-center ml-4">
                                                    <label class="text-sm mr-2">Required</label>
                                                    <input type="checkbox" asp-for="Questions[i].Required" class="h-4 w-4" />
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <button type="button" class="move-up bg-secondary p-2 rounded-md">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M12 19V5M12 5L5 12M12 5L19 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    </svg>
                                                </button>
                                                <button type="button" class="move-down bg-secondary p-2 rounded-md">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M12 5V19M12 19L5 12M12 19L19 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    </svg>
                                                </button>
                                                <button type="button" class="delete-question bg-secondary p-2 rounded-md hover:text-destructive">
                                                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M3 6H5H21M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-content space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium mb-1">Question Title</label>
                                                <input asp-for="Questions[i].Title" class="w-full px-4 py-2 border rounded-md" placeholder="Enter your question" />
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium mb-1">Description (optional)</label>
                                                <input asp-for="Questions[i].Description" class="w-full px-4 py-2 border rounded-md" placeholder="Add a description for your question" />
                                            </div>
                                            
                                            <div class="options-container" data-question-type="single-choice">
                                                <div class="flex items-center justify-between mb-2">
                                                    <label class="text-sm font-medium">Options</label>
                                                    <button type="button" class="add-option text-sm text-primary flex items-center">
                                                        <svg class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                        </svg>
                                                        Add Option
                                                    </button>
                                                </div>
                                                <div class="space-y-2 options-list">
                                                    @for (var j = 0; j < Model.Questions[i].Options.Count; j++)
                                                    {
                                                        <div class="flex items-center option-item">
                                                            <input type="text" name="Questions[@i].Options[@j]" value="@Model.Questions[i].Options[j]" class="flex-1 px-4 py-2 border rounded-md" />
                                                            <button type="button" class="delete-option ml-2 text-destructive">
                                                                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                                </svg>
                                                            </button>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                            
                            <div class="flex justify-end space-x-4 mt-8">
                                <button type="button" class="preview-button bg-secondary text-secondary-foreground hover:bg-accent hover:text-accent-foreground px-4 py-2 rounded-md">
                                    Preview
                                </button>
                                <button type="submit" class="bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 rounded-md flex items-center">
                                    <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M19 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H16L21 8V19C21 20.1046 20.1046 21 19 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M17 21V13H7V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M7 3V8H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Save Survey
                                </button>
                                @if (!string.IsNullOrEmpty(Model.Id))
                                {
                                    <button type="button" class="share-button bg-secondary text-secondary-foreground hover:bg-accent hover:text-accent-foreground px-4 py-2 rounded-md flex items-center">
                                        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M18 8C19.6569 8 21 6.65685 21 5C21 3.34315 19.6569 2 18 2C16.3431 2 15 3.34315 15 5C15 6.65685 16.3431 8 18 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M6 15C7.65685 15 9 13.6569 9 12C9 10.3431 7.65685 9 6 9C4.34315 9 3 10.3431 3 12C3 13.6569 4.34315 15 6 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M18 22C19.6569 22 21 20.6569 21 19C21 17.3431 19.6569 16 18 16C16.3431 16 15 17.3431 15 19C15 20.6569 16.3431 22 18 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M8.59 13.51L15.42 17.49" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M15.41 6.51L8.59 10.49" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Share Survey
                                    </button>
                                }
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div x-show="activeTab === 'delivery'" class="tab-content animate-fade-in">
                <div class="grid gap-8">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Email Delivery Configuration</h2>
                        </div>
                        <div class="card-content space-y-6">
                            <div>
                                <h3 class="text-lg font-medium mb-4">Delivery Method</h3>
                                <div class="space-y-3">
                                    <div class="flex items-start space-x-2">
                                        <input type="radio" id="manual-delivery" name="delivery-type" value="manual" class="mt-1" checked />
                                        <div class="grid gap-1.5">
                                            <label for="manual-delivery" class="font-medium">Manual Sending</label>
                                            <p class="text-sm text-muted-foreground">
                                                Send surveys manually when needed
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start space-x-2">
                                        <input type="radio" id="scheduled-delivery" name="delivery-type" value="scheduled" class="mt-1" />
                                        <div class="grid gap-1.5">
                                            <label for="scheduled-delivery" class="font-medium">Scheduled</label>
                                            <p class="text-sm text-muted-foreground">
                                                Send surveys on a regular schedule (daily, weekly, monthly)
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-start space-x-2">
                                        <input type="radio" id="triggered-delivery" name="delivery-type" value="triggered" class="mt-1" />
                                        <div class="grid gap-1.5">
                                            <label for="triggered-delivery" class="font-medium">Event Triggered</label>
                                            <p class="text-sm text-muted-foreground">
                                                Send surveys when specific events occur (ticket closed, purchase completed)
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <hr class="border-t border-border" />
                            
                            <div>
                                <h3 class="text-lg font-medium mb-4">Recipient Emails</h3>
                                <div class="flex space-x-2 mb-4">
                                    <input type="email" id="email-input" placeholder="Add email address" class="flex-1 px-4 py-2 border rounded-md" />
                                    <button type="button" id="add-email" class="bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 rounded-md">Add</button>
                                </div>

                                <div class="flex space-x-2 mb-4">
                                    <button type="button" id="toggle-customers" class="border border-input bg-background hover:bg-accent hover:text-accent-foreground px-4 py-2 rounded-md flex-1 flex items-center justify-center">
                                        <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M9 11C11.2091 11 13 9.20914 13 7C13 4.79086 11.2091 3 9 3C6.79086 3 5 4.79086 5 7C5 9.20914 6.79086 11 9 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Select from Customers
                                    </button>
                                </div>
                                
                                <div id="customer-selector" class="hidden border rounded-md p-4 mb-4 bg-background">
                                    <div class="flex justify-between items-center mb-3">
                                        <h4 class="font-medium">Customer Selection</h4>
                                        <div class="flex space-x-2">
                                            <button type="button" id="select-all" class="text-xs border border-input bg-background hover:bg-accent hover:text-accent-foreground px-2 py-1 rounded-md flex items-center">
                                                <svg class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                Select All
                                            </button>
                                            <button type="button" id="deselect-all" class="text-xs border border-input bg-background hover:bg-accent hover:text-accent-foreground px-2 py-1 rounded-md flex items-center">
                                                <svg class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                Deselect All
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <input type="text" id="customer-filter" placeholder="Filter customers..." class="w-full px-4 py-2 border rounded-md mb-3" />
                                    
                                    <div class="max-h-60 overflow-auto border rounded-md" id="customer-list">
                                        <!-- Customer list will be populated by JavaScript -->
                                    </div>
                                </div>
                                
                                <div id="email-recipients" class="border rounded-md p-4 mb-4 bg-background hidden">
                                    <button type="button" id="toggle-recipients" class="w-full flex justify-between items-center mb-3 border border-input bg-background hover:bg-accent hover:text-accent-foreground px-4 py-2 rounded-md">
                                        <span class="font-medium">Selected Recipients (<span id="recipient-count">0</span>)</span>
                                        <svg id="recipients-chevron" class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                    
                                    <div id="recipients-list" class="space-y-2 mt-4 max-h-60 overflow-auto hidden">
                                        <!-- Recipients will be populated by JavaScript -->
                                    </div>
                                </div>
                                
                                <p id="no-recipients" class="text-sm text-muted-foreground mb-4">No recipients added yet</p>
                            </div>
                            
                            <div id="schedule-config" class="hidden">
                                <hr class="border-t border-border" />
                                
                                <div class="space-y-4">
                                    <h3 class="text-lg font-medium">Schedule Configuration</h3>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <label for="frequency" class="block text-sm font-medium mb-1">Frequency</label>
                                            <select id="frequency" class="w-full px-4 py-2 border rounded-md">
                                                <option value="daily">Daily</option>
                                                <option value="weekly">Weekly</option>
                                                <option value="monthly" selected>Monthly</option>
                                            </select>
                                        </div>
                                        
                                        <div id="day-of-week-container" class="hidden">
                                            <label for="day-of-week" class="block text-sm font-medium mb-1">Day of Week</label>
                                            <select id="day-of-week" class="w-full px-4 py-2 border rounded-md">
                                                <option value="1">Monday</option>
                                                <option value="2">Tuesday</option>
                                                <option value="3">Wednesday</option>
                                                <option value="4">Thursday</option>
                                                <option value="5">Friday</option>
                                                <option value="6">Saturday</option>
                                                <option value="0">Sunday</option>
                                            </select>
                                        </div>
                                        
                                        <div id="day-of-month-container">
                                            <label for="day-of-month" class="block text-sm font-medium mb-1">Day of Month</label>
                                            <select id="day-of-month" class="w-full px-4 py-2 border rounded-md">
                                                @for (int day = 1; day <= 31; day++)
                                                {
                                                    <option value="@day">@day</option>
                                                }
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label for="time" class="block text-sm font-medium mb-1">Time of Day</label>
                                            <input type="time" id="time" value="09:00" class="w-full px-4 py-2 border rounded-md" />
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium mb-1">Start Date</label>
                                            <button type="button" id="date-picker" class="w-full flex justify-start items-center border border-input bg-background hover:bg-accent hover:text-accent-foreground px-4 py-2 rounded-md">
                                                <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M16 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M8 2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                    <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                                <span id="selected-date">Pick a date</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="trigger-config" class="hidden">
                                <hr class="border-t border-border" />
                                
                                <div class="space-y-4">
                                    <h3 class="text-lg font-medium">Trigger Configuration</h3>
                                    
                                    <div>
                                        <label for="trigger-type" class="block text-sm font-medium mb-1">Trigger Event</label>
                                        <select id="trigger-type" class="w-full px-4 py-2 border rounded-md">
                                            <option value="ticket-closed">Ticket Closed</option>
                                            <option value="purchase-completed">Purchase Completed</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label for="delay" class="block text-sm font-medium mb-1">Delay (hours)</label>
                                        <input type="number" id="delay" value="24" min="0" class="w-full px-4 py-2 border rounded-md" placeholder="24" />
                                        <p class="text-xs text-muted-foreground mt-1">
                                            Time to wait after the trigger event before sending the survey
                                        </p>
                                    </div>

                                    <div class="flex items-center space-x-2">
                                        <input type="checkbox" id="auto-send" class="h-4 w-4" />
                                        <label for="auto-send" class="cursor-pointer">
                                            <div class="font-medium">Send automatically</div>
                                            <p class="text-xs text-muted-foreground">
                                                Automatically send surveys when the ticket is closed
                                            </p>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end mt-4">
                                <button type="button" id="send-emails" class="bg-primary text-primary-foreground hover:bg-primary/90 px-4 py-2 rounded-md flex items-center" disabled>
                                    <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M4 4H20C21.1 4 22 4.9 22 6V18C22 19.1 21.1 20 20 20H4C2.9 20 2 19.1 2 18V6C2 4.9 2.9 4 4 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M22 6L12 13L2 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    Send Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div x-show="activeTab === 'settings'" class="tab-content animate-fade-in">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Survey Settings</h2>
                    </div>
                    <div class="card-content space-y-6">
                        <div>
                            <h3 class="text-lg font-medium mb-4">Data Collection</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">Allow anonymous responses</h4>
                                        <p class="text-sm text-muted-foreground">Respondents can submit without identifying themselves</p>
                                    </div>
                                    <div class="flex items-center h-6">
                                        <input type="checkbox" id="anonymous" class="mr-2" checked />
                                        <label for="anonymous">Enable</label>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">Multiple submissions</h4>
                                        <p class="text-sm text-muted-foreground">Allow respondents to submit multiple times</p>
                                    </div>
                                    <div class="flex items-center h-6">
                                        <input type="checkbox" id="multiple" class="mr-2" />
                                        <label for="multiple">Enable</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-medium mb-4">Display Options</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">Show progress bar</h4>
                                        <p class="text-sm text-muted-foreground">Display completion progress to respondents</p>
                                    </div>
                                    <div class="flex items-center h-6">
                                        <input type="checkbox" id="progress" class="mr-2" checked />
                                        <label for="progress">Enable</label>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">Show question numbers</h4>
                                        <p class="text-
